{% extends 'base.html.twig' %}

{% block title %}{{ 'pages.archive_configuration'|trans }} - {{ 'app.name'|trans }}{% endblock %}

{% block header %}
<header class="bg-white shadow">
    <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900">{{ 'actions.create_new_archive'|trans }}</h1>
    </div>
</header>
{% endblock %}

{% block content %}
<div class="mx-auto">
    <div class="bg-white shadow rounded-lg">
        <div class="px-4 py-5 sm:p-6">
            <div class="mb-6">
                <h2 class="text-lg font-medium text-gray-900 mb-2">{{ 'pages.archive_configuration'|trans }}</h2>
                <p class="text-sm text-gray-600">
                    {{ 'pages.archive_configuration_description'|trans }}
                </p>
            </div>

            {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

            <!-- Basic Information -->
            <div class="space-y-4">
                <h3 class="text-md font-medium text-gray-900 border-b border-gray-200 pb-2">
                    {{ 'pages.basic_information'|trans }}
                </h3>

                <div>
                    {{ form_label(form.url, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                    {{ form_widget(form.url, {'attr': {'class': 'w-full px-3 py-2 rounded-md border border-gray-300 shadow focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                    {{ form_help(form.url, {'help_attr': {'class': 'mt-1 text-xs text-gray-500'}}) }}
                    {{ form_errors(form.url, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                </div>

                <div>
                    {{ form_label(form.title, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                    {{ form_widget(form.title, {'attr': {'class': 'w-full px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                    {{ form_help(form.title, {'help_attr': {'class': 'mt-1 text-xs text-gray-500'}}) }}
                    {{ form_errors(form.title, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                </div>

                <div>
                    {{ form_label(form.description, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                    {{ form_widget(form.description, {'attr': {'class': 'w-full px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                    {{ form_help(form.description, {'help_attr': {'class': 'mt-1 text-xs text-gray-500'}}) }}
                    {{ form_errors(form.description, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                </div>
            </div>

            <!-- Crawling Options -->
            <div class="space-y-4">
                <h3 class="text-md font-medium text-gray-900 border-b border-gray-200 pb-2">
                    {{ 'pages.crawling_options'|trans }}
                </h3>

                <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
                    <div>
                        {{ form_label(form.maxDepth, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                        {{ form_widget(form.maxDepth, {'attr': {'class': 'w-full px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                        {{ form_help(form.maxDepth, {'help_attr': {'class': 'mt-1 text-xs text-gray-500'}}) }}
                        {{ form_errors(form.maxDepth, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                    </div>

                    <div>
                        {{ form_label(form.maxPages, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                        {{ form_widget(form.maxPages, {'attr': {'class': 'w-full px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                        {{ form_help(form.maxPages, {'help_attr': {'class': 'mt-1 text-xs text-gray-500'}}) }}
                        {{ form_errors(form.maxPages, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                    </div>

                    <div>
                        {{ form_label(form.crawlDelay, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                        {{ form_widget(form.crawlDelay, {'attr': {'class': 'w-full px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                        {{ form_help(form.crawlDelay, {'help_attr': {'class': 'mt-1 text-xs text-gray-500'}}) }}
                        {{ form_errors(form.crawlDelay, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                    </div>
                </div>
            </div>

            <!-- Content Options -->
            <div class="space-y-4">
                <h3 class="text-md font-medium text-gray-900 border-b border-gray-200 pb-2">
                    {{ 'pages.content_options'|trans }}
                </h3>

                <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div class="space-y-1">
                        {{ form_widget(form.includeImages, {
                            'attr': {'class': 'h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded'},
                            'label_attr': {'class': 'ml-2 text-sm font-medium text-gray-700'}
                        }) }}
                        {{ form_help(form.includeImages, {'help_attr': {'class': 'ml-8 text-xs text-gray-500'}}) }}
                        {{ form_errors(form.includeImages, {'error_attr': {'class': 'ml-7 mt-1 text-xs text-red-600'}}) }}
                    </div>

                    <div class="space-y-1">
                        {{ form_widget(form.includeCSS, {
                            'attr': {'class': 'h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded'},
                            'label_attr': {'class': 'ml-2 text-sm font-medium text-gray-700'}
                        }) }}
                        {{ form_help(form.includeCSS, {'help_attr': {'class': 'ml-8 text-xs text-gray-500'}}) }}
                        {{ form_errors(form.includeCSS, {'error_attr': {'class': 'ml-7 mt-1 text-xs text-red-600'}}) }}
                    </div>

                    <div class="space-y-1">
                        {{ form_widget(form.includeJS, {
                            'attr': {'class': 'h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded'},
                            'label_attr': {'class': 'ml-2 text-sm font-medium text-gray-700'}
                        }) }}
                        {{ form_help(form.includeJS, {'help_attr': {'class': 'ml-8 text-xs text-gray-500'}}) }}
                        {{ form_errors(form.includeJS, {'error_attr': {'class': 'ml-7 mt-1 text-xs text-red-600'}}) }}
                    </div>

                    <div class="space-y-1">
                        {{ form_widget(form.followExternalLinks, {
                            'attr': {'class': 'h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded'},
                            'label_attr': {'class': 'ml-2 text-sm font-medium text-gray-700'}
                        }) }}
                        {{ form_help(form.followExternalLinks, {'help_attr': {'class': 'ml-8 text-xs text-gray-500'}}) }}
                        {{ form_errors(form.followExternalLinks, {'error_attr': {'class': 'ml-7 mt-1 text-xs text-red-600'}}) }}
                    </div>
                </div>
            </div>

            <!-- Advanced Options -->
            <div class="space-y-4">
                <h3 class="text-md font-medium text-gray-900 border-b border-gray-200 pb-2">
                    {{ 'pages.advanced_options'|trans }}
                </h3>

                <div>
                    {{ form_label(form.excludeUrls, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                    <div id="exclude-urls-collection" class="space-y-2">
                        {% for excludeUrl in form.excludeUrls %}
                            <div class="flex items-center space-x-2 collection-item">
                                {{ form_widget(excludeUrl, {'attr': {'class': 'flex-1 px-3 py-2 rounded-md border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                                <button type="button" class="inline-flex items-center px-2 py-1 border border-red-300 text-sm font-medium rounded text-red-700 bg-red-50 hover:bg-red-100" onclick="collectionManager.removeItem(this, 'exclude-urls-collection')">
                                    {{ 'actions.remove'|trans }}
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="mt-2 inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" onclick="collectionManager.addItem('exclude-urls-collection')">
                        {{ 'actions.add_url'|trans }}
                    </button>
                    {{ form_help(form.excludeUrls, {'help_attr': {'class': 'mt-1 text-sm text-gray-500'}}) }}
                    {{ form_errors(form.excludeUrls, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                </div>

                <div>
                    {{ form_label(form.excludePatterns, null, {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                    <div id="exclude-patterns-collection" class="space-y-2">
                        {% for excludePattern in form.excludePatterns %}
                            <div class="flex items-center space-x-2 collection-item">
                                {{ form_widget(excludePattern, {'attr': {'class': 'flex-1 px-3 py-2 rounded-md border-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500'}}) }}
                                <button type="button" class="inline-flex items-center px-2 py-1 border border-red-300 text-sm font-medium rounded text-red-700 bg-red-50 hover:bg-red-100" onclick="collectionManager.removeItem(this, 'exclude-patterns-collection')">
                                    {{ 'actions.remove'|trans }}
                                </button>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="mt-2 inline-flex items-center px-3 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" onclick="collectionManager.addItem('exclude-patterns-collection')">
                        {{ 'actions.add_pattern'|trans }}
                    </button>
                    {{ form_help(form.excludePatterns, {'help_attr': {'class': 'mt-1 text-sm text-gray-500'}}) }}
                    {{ form_errors(form.excludePatterns, {'error_attr': {'class': 'mt-1 text-sm text-red-600'}}) }}
                </div>
            </div>

            <!-- Submit Button -->
            <div class="pt-6 border-t border-gray-200">
                {{ form_widget(form.submit, {'attr': {'class': 'w-full bg-indigo-600 border border-transparent rounded-md py-3 px-8 flex items-center justify-center text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500'}}) }}
            </div>

            {# Hide the original collection fields since we handle them with custom JavaScript #}
            <div style="display: none;">
                {{ form_widget(form.excludeUrls) }}
                {{ form_widget(form.excludePatterns) }}
            </div>

            {{ form_end(form) }}
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
window.translations = {
    'placeholders.enter_url_to_exclude': '{{ 'placeholders.enter_url_to_exclude'|trans|escape('js') }}',
    'placeholders.enter_pattern_to_exclude': '{{ 'placeholders.enter_pattern_to_exclude'|trans|escape('js') }}',
    'actions.remove': '{{ 'actions.remove'|trans|escape('js') }}'
};
</script>
{% endblock %}
